# FIT-DNA 서비스 구현 가이드

## 📋 목차
1. [FIT-DNA 개요](#1-fit-dna-개요)
2. [측정항목 매핑표](#2-측정항목-매핑표)
3. [성별 구분 필요성](#3-성별-구분-필요성)
4. [체력 측정 입력 가이드](#4-체력-측정-입력-가이드)
5. [FIT-DNA 계산 프로세스](#5-fit-dna-계산-프로세스)

---

## 1. FIT-DNA 개요

### 1.1 FIT-DNA란?
**FIT-DNA**는 개인의 체력 측정 데이터를 기반으로 3가지 축(근력, 유연성, 지구력)을 분석하여
총 **8가지 체력 유형**으로 분류하는 체력 MBTI 시스템입니다.

### 1.2 8가지 유형 구성
```
3개 축 × 2가지 레벨 = 8가지 조합

1. 근력 (Strength)
   - Power (P): 높은 근력
   - Light (L): 낮은 근력

2. 유연성 (Flexibility)
   - Flexibility (F): 유연함
   - Stiff (S): 경직됨

3. 지구력 (Endurance)
   - Endurance (E): 높은 지구력
   - Quick (Q): 낮은 지구력
```

**8가지 유형:**
- **PFE** (Power-Flexibility-Endurance): 전천후 체력왕
- **PFQ** (Power-Flexibility-Quick): 순발력형 파워
- **PSE** (Power-Stiff-Endurance): 파워 지구력형
- **PSQ** (Power-Stiff-Quick): 순간 파워형
- **LFE** (Light-Flexibility-Endurance): 유연한 지구력형
- **LFQ** (Light-Flexibility-Quick): 유연성 특화형
- **LSE** (Light-Stiff-Endurance): 지구력 특화형
- **LSQ** (Light-Stiff-Quick): 기초 체력 향상 필요형

---

## 2. 측정항목 매핑표

### 2.1 국민체력100 기준 측정항목

FIT-DNA는 국민체력100의 52개 측정항목 중 **15개 핵심 항목**을 사용합니다.

#### 📊 근력 (Strength) 측정 항목 (8개)

| 항목명 | 설명 | 단위 | 비고 |
|--------|------|------|------|
| 악력(좌) | 왼손 악력 | kg | 필수 |
| 악력(우) | 오른손 악력 | kg | 필수 |
| 배근력 | 등 근력 | kg | 선택 |
| 각근력 | 다리 근력 | kg | 선택 |
| 윗몸일으키기 | 복근력 | 회/분 | 필수 |
| 팔굽혀펴기 | 상체 근력 | 회 | 선택 |
| 제자리멀리뛰기 | 하체 폭발력 | cm | 필수 |
| 윗몸말아올리기 | 복근 지구력 | 회/분 | 선택 |

**근력 Z-Score 계산:**
```python
strength_z = mean([
    악력_좌_z, 악력_우_z, 배근력_z, 각근력_z,
    윗몸일으키기_z, 팔굽혀펴기_z, 제자리멀리뛰기_z, 윗몸말아올리기_z
])
```

#### 🧘 유연성 (Flexibility) 측정 항목 (1개)

| 항목명 | 설명 | 단위 | 비고 |
|--------|------|------|------|
| 앉아윗몸앞으로굽히기 | 유연성 | cm | 필수 |

**유연성 Z-Score 계산:**
```python
flex_z = 앉아윗몸앞으로굽히기_z
```

#### 🏃 지구력 (Endurance) 측정 항목 (6개)

| 항목명 | 설명 | 단위 | 비고 |
|--------|------|------|------|
| 6분 걷기 | 유산소 지구력 | m | 선택 |
| 왕복오래달리기 | 심폐지구력 | 회 | 선택 |
| 오래달리기-걷기 | 유산소 능력 | 초 | 선택 |
| 심폐지구력 | 유산소 능력 | mL/kg/min | 선택 |
| VO₂max | 최대산소섭취량 | mL/kg/min | 필수 |
| 스텝검사 | 심폐능력 | 점수 | 선택 |

**지구력 Z-Score 계산:**
```python
endurance_z = mean([
    6분걷기_z, 왕복오래달리기_z, 오래달리기걷기_z,
    심폐지구력_z, VO2max_z, 스텝검사_z
])
```

### 2.2 축별 결측 처리 규칙

**중요:** 한 축을 구성하는 모든 항목이 NaN이면 해당 레코드 제외

```
예시 1: 근력 항목 중 악력(좌), 악력(우), 제자리멀리뛰기만 측정
→ 3개 항목의 평균 Z-score로 근력 축 계산 가능 ✅

예시 2: 근력 항목이 모두 NaN
→ 근력 축 계산 불가 → 전체 레코드 제외 ❌

예시 3: 유연성(앉아윗몸앞으로굽히기)이 NaN
→ 유연성 축 계산 불가 → 전체 레코드 제외 ❌
```

---

## 3. 성별 구분 필요성

### 3.1 왜 성별 구분이 필수인가?

FIT-DNA는 **연령대 × 성별 그룹별 표준화(Z-Score)**를 사용하기 때문에 성별 정보는 필수입니다.

#### 표준화 공식
```python
z_score = (개인값 - 그룹평균) / 그룹표준편차

여기서 그룹 = (연령대, 성별) 조합
예: (20대, 남성), (30대, 여성), ...
```

#### 성별에 따른 체력 차이 (분석 결과)

| 지표 | 남성 평균 | 여성 평균 | 차이 |
|------|-----------|-----------|------|
| 악력 | 45.2 kg | 26.8 kg | 약 1.7배 |
| 윗몸일으키기 | 32회/분 | 21회/분 | 약 1.5배 |
| 제자리멀리뛰기 | 215 cm | 165 cm | 약 1.3배 |
| 유연성 | 14.2 cm | 17.5 cm | 여성이 더 유연 |

**→ 성별 구분 없이는 정확한 체력 평가 불가능!**

### 3.2 서비스 UI에서의 성별 입력

```
┌─────────────────────────────────────┐
│  FIT-DNA 체력 유형 검사             │
├─────────────────────────────────────┤
│  기본 정보 입력                     │
│                                     │
│  나이: [____] 세                    │
│                                     │
│  성별: ○ 남성  ○ 여성              │
│                                     │
│  키: [____] cm                      │
│                                     │
│  몸무게: [____] kg                  │
│                                     │
│  [다음 단계: 체력 측정값 입력]      │
└─────────────────────────────────────┘
```

---

## 4. 체력 측정 입력 가이드

### 4.1 최소 필수 입력 항목

FIT-DNA 계산을 위한 **최소 필수 항목** (사용자 부담 최소화)

| 축 | 필수 항목 | 개수 |
|----|-----------|------|
| 근력 | 악력(좌), 악력(우), 제자리멀리뛰기 | 3개 |
| 유연성 | 앉아윗몸앞으로굽히기 | 1개 |
| 지구력 | VO₂max | 1개 |

**총 5개 항목만으로도 FIT-DNA 계산 가능!**

### 4.2 입력 화면 예시 (단계별)

#### STEP 1: 근력 측정
```
┌─────────────────────────────────────┐
│  근력 측정값 입력                   │
├─────────────────────────────────────┤
│  필수 항목                          │
│  • 악력(좌): [____] kg              │
│  • 악력(우): [____] kg              │
│  • 제자리멀리뛰기: [____] cm        │
│                                     │
│  선택 항목 (더 정확한 분석)         │
│  • 윗몸일으키기: [____] 회/분       │
│  • 팔굽혀펴기: [____] 회            │
│                                     │
│  [다음]                             │
└─────────────────────────────────────┘
```

#### STEP 2: 유연성 측정
```
┌─────────────────────────────────────┐
│  유연성 측정값 입력                 │
├─────────────────────────────────────┤
│  필수 항목                          │
│  • 앉아윗몸앞으로굽히기: [____] cm  │
│                                     │
│  [다음]                             │
└─────────────────────────────────────┘
```

#### STEP 3: 지구력 측정
```
┌─────────────────────────────────────┐
│  지구력 측정값 입력                 │
├─────────────────────────────────────┤
│  필수 항목                          │
│  • VO₂max: [____] mL/kg/min         │
│                                     │
│  선택 항목                          │
│  • 6분 걷기: [____] m               │
│  • 왕복오래달리기: [____] 회        │
│                                     │
│  [FIT-DNA 분석 시작]                │
└─────────────────────────────────────┘
```

### 4.3 사진 업로드 기능 (IA 명세 반영)

국민체력100 측정 결과지를 사진으로 촬영하여 자동 입력

```
┌─────────────────────────────────────┐
│  측정값 입력 방법 선택              │
├─────────────────────────────────────┤
│  ○ 직접 입력                        │
│  ○ 국민체력100 결과지 촬영          │
│                                     │
│  [사진 촬영] 또는 [갤러리에서 선택] │
│                                     │
│  ※ AI가 자동으로 측정값 추출       │
└─────────────────────────────────────┘
```

**OCR 처리 필요 필드:**
- 악력(좌/우), 제자리멀리뛰기
- 앉아윗몸앞으로굽히기
- VO₂max
- (선택) 기타 측정값

---

## 5. FIT-DNA 계산 프로세스

### 5.1 전체 흐름도

```
┌──────────────────┐
│ 1. 기본정보 입력 │
│ (나이, 성별)     │
└────────┬─────────┘
         ↓
┌──────────────────┐
│ 2. 체력 측정값   │
│    입력/촬영     │
└────────┬─────────┘
         ↓
┌──────────────────┐
│ 3. 연령대×성별   │
│    그룹 매칭     │
└────────┬─────────┘
         ↓
┌──────────────────┐
│ 4. Z-Score 계산  │
│    (표준화)      │
└────────┬─────────┘
         ↓
┌──────────────────┐
│ 5. 축별 Z-Score  │
│    평균 계산     │
└────────┬─────────┘
         ↓
┌──────────────────┐
│ 6. 50% 기준      │
│    상/하 분류    │
└────────┬─────────┘
         ↓
┌──────────────────┐
│ 7. FIT-DNA 코드  │
│    생성 (예:PFE) │
└──────────────────┘
```

### 5.2 상세 계산 로직

#### STEP 1: 연령대 그룹 분류
```python
if age < 13:
    age_group = "유아기"
elif age < 19:
    age_group = "청소년"
elif age < 65:
    age_group = "성인"
else:
    age_group = "어르신"
```

#### STEP 2: 개별 항목 Z-Score 계산
```python
# 예: 20대 남성의 악력(좌) 측정값이 45kg일 때
group = df[(df['연령대'] == '20대') & (df['성별'] == 'M')]
mean_grip = group['악력좌'].mean()  # 예: 42.5 kg
std_grip = group['악력좌'].std()    # 예: 5.2 kg

z_grip_left = (45 - 42.5) / 5.2 = 0.48
```

#### STEP 3: 축별 Z-Score 평균
```python
# 근력 축: 악력(좌), 악력(우), 제자리멀리뛰기만 측정한 경우
strength_z = (z_grip_left + z_grip_right + z_jump) / 3

# 유연성 축
flex_z = z_flexibility

# 지구력 축: VO2max만 측정한 경우
endurance_z = z_vo2max
```

#### STEP 4: Power/Light 분류
```python
# 전체 데이터의 50% 기준
median_strength = df['strength_z'].median()

if strength_z >= median_strength:
    power_flag = "Power"
else:
    power_flag = "Light"
```

#### STEP 5: Flexibility/Stiff 분류
```python
median_flex = df['flex_z'].median()

if flex_z >= median_flex:
    flex_flag = "Flexibility"
else:
    flex_flag = "Stiff"
```

#### STEP 6: Endurance/Quick 분류
```python
median_endurance = df['endurance_z'].median()

if endurance_z >= median_endurance:
    endurance_flag = "Endurance"
else:
    endurance_flag = "Quick"
```

#### STEP 7: FIT-DNA 코드 생성
```python
# 약자 매핑
P_or_L = "P" if power_flag == "Power" else "L"
F_or_S = "F" if flex_flag == "Flexibility" else "S"
E_or_Q = "E" if endurance_flag == "Endurance" else "Q"

FIT_DNA = P_or_L + F_or_S + E_or_Q
# 예: "PFE"
```

---

## 6. 구현 체크리스트

### 6.1 백엔드 개발 체크리스트

- [ ] 성별 입력 필드 필수 검증
- [ ] 연령대 자동 분류 로직
- [ ] Z-Score 계산 함수 (연령대×성별 그룹별)
- [ ] 축별 결측 처리 로직
- [ ] 50% 중앙값 기준 분류
- [ ] FIT-DNA 코드 생성 함수
- [ ] OCR 이미지 처리 (선택)

### 6.2 프론트엔드 UI 체크리스트

- [ ] 성별 선택 라디오 버튼
- [ ] 나이 입력 필드 (숫자만)
- [ ] 체력 측정값 입력 폼 (단위 표시)
- [ ] 필수/선택 항목 구분 표시
- [ ] 사진 업로드 버튼 (선택)
- [ ] 입력값 유효성 검증 (범위 체크)

### 6.3 데이터 검증 규칙

| 항목 | 유효 범위 | 에러 메시지 |
|------|-----------|-------------|
| 나이 | 7~100세 | "7세 이상 100세 이하만 가능합니다" |
| 악력 | 5~100 kg | "악력은 5~100 kg 사이여야 합니다" |
| 제자리멀리뛰기 | 50~350 cm | "50~350 cm 사이 값을 입력하세요" |
| 유연성 | -20~50 cm | "-20~50 cm 사이 값을 입력하세요" |
| VO₂max | 10~80 mL/kg/min | "10~80 사이 값을 입력하세요" |

---

## 7. 참고: 분석 데이터 통계

### 7.1 실제 데이터 기반 통계 (115,983건)

| FIT-DNA | 건수 | 비율 | 특징 |
|---------|------|------|------|
| PFE | 24,700 | 21.3% | **가장 많은 유형** - 균형잡힌 체력 |
| LSQ | 21,925 | 18.9% | **두번째로 많음** - 개선 필요형 |
| LFQ | 14,438 | 12.4% | 유연성 특화 |
| PFQ | 12,980 | 11.2% | 순발력형 |
| LSE | 11,108 | 9.6% | 지구력 특화 |
| PSE | 10,947 | 9.4% | 파워 지구력형 |
| LFE | 10,460 | 9.0% | 유연한 지구력형 |
| PSQ | 9,425 | 8.1% | **가장 적은 유형** - 순간 파워형 |

### 7.2 유형별 평균 Z-Score

| 유형 | 근력 | 유연성 | 지구력 |
|------|------|--------|--------|
| PFE | +0.68 | +0.81 | +0.88 |
| LSQ | -0.75 | -0.97 | -0.89 |
| LFQ | -0.58 | +0.62 | -0.78 |
| PFQ | +0.58 | +0.72 | -0.65 |

---

## 8. 문의 및 기술 지원

- 데이터 분석: Phase 1 분석 보고서 참조
- 모델링: Phase 2 개발 예정
- 전처리 코드: `fit_dna_preprocessed_cp949.csv` 생성 로직 참조

---

**작성일:** 2025-11-23
**버전:** 1.0
**작성자:** FIT-DNA 데이터 분석팀
